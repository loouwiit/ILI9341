#include "font.hpp"
#include "mutex.hpp"
#include "storge/fat.hpp"
#include "cstring"

const unsigned char* const Font::error = Font::errorTable;

class FontBuiltIn : public Font
{
public:
	constexpr FontBuiltIn() : Font({ 8,16 }) {}
	virtual const unsigned char* get(Unicode text) const override
	{
		if (text < 0x20) return error;

		text -= 0x20;
		if (text >= (sizeof(table) / sizeof(table[0]))) return error;

		return table[text];
	}

private:
	constexpr static unsigned char table[95][16] = {
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //' '
		{0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x10,0x10,0x00,0x00}, //'!'
		{0x00,0x00,0x6C,0x6C,0x24,0x24,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'"'
		{0x00,0x24,0x24,0x24,0x24,0xFE,0x48,0x48,0x48,0x48,0xFC,0x90,0x90,0x90,0x90,0x00}, //'#'
		{0x00,0x10,0x3C,0x54,0x92,0x90,0x50,0x38,0x14,0x12,0x12,0x92,0x54,0x78,0x10,0x00}, //'$'
		{0x00,0x00,0x22,0x5C,0x94,0xA8,0x48,0x10,0x10,0x24,0x2A,0x52,0x54,0x88,0x00,0x00}, //'%'
		{0x00,0x00,0x30,0x48,0x48,0x50,0x20,0x6E,0x54,0x94,0x8C,0x88,0x8A,0x74,0x00,0x00}, //'&'
		{0x00,0x00,0x30,0x30,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'\''
		{0x00,0x04,0x08,0x10,0x10,0x20,0x20,0x20,0x20,0x20,0x20,0x10,0x10,0x08,0x04,0x00}, //'('
		{0x00,0x80,0x40,0x20,0x20,0x10,0x10,0x10,0x10,0x10,0x10,0x20,0x20,0x40,0x80,0x00}, //')'
		{0x00,0x00,0x00,0x00,0x10,0x54,0x38,0x10,0x38,0x54,0x10,0x00,0x00,0x00,0x00,0x00}, //'*'
		{0x00,0x00,0x00,0x10,0x10,0x10,0x10,0xFE,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00}, //'+'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x20,0x00}, //','
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'-'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00}, //'.'
		{0x00,0x00,0x04,0x04,0x08,0x08,0x10,0x10,0x20,0x20,0x40,0x40,0x80,0x80,0x00,0x00}, //'/'
		{0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x92,0x92,0x82,0x82,0x82,0x44,0x38,0x00,0x00}, //'0'
		{0x00,0x00,0x10,0x70,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x7C,0x00,0x00}, //'1'
		{0x00,0x00,0x38,0x44,0x82,0x82,0x04,0x08,0x10,0x20,0x40,0x82,0x84,0xFC,0x00,0x00}, //'2'
		{0x00,0x00,0x38,0x44,0x82,0x02,0x04,0x38,0x04,0x02,0x02,0x82,0x44,0x38,0x00,0x00}, //'3'
		{0x00,0x00,0x04,0x0C,0x14,0x14,0x24,0x24,0x44,0x44,0xFE,0x04,0x04,0x0E,0x00,0x00}, //'4'
		{0x00,0x00,0xFC,0x80,0x80,0x80,0xB8,0xC4,0x82,0x02,0x02,0x82,0x84,0x78,0x00,0x00}, //'5'
		{0x00,0x00,0x3C,0x42,0x82,0x80,0xB8,0xC4,0x82,0x82,0x82,0x82,0x44,0x38,0x00,0x00}, //'6'
		{0x00,0x00,0x7E,0x42,0x82,0x04,0x04,0x08,0x08,0x08,0x10,0x10,0x10,0x10,0x00,0x00}, //'7'
		{0x00,0x00,0x38,0x44,0x82,0x82,0x44,0x38,0x44,0x82,0x82,0x82,0x44,0x38,0x00,0x00}, //'8'
		{0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x46,0x3A,0x02,0x82,0x44,0x38,0x00,0x00}, //'9'
		{0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,0x00,0x00}, //':'
		{0x00,0x00,0x00,0x00,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x20,0x00,0x00}, //';'
		{0x00,0x00,0x00,0x00,0x06,0x18,0x60,0x80,0x60,0x18,0x06,0x00,0x00,0x00,0x00,0x00}, //'<'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00}, //'='
		{0x00,0x00,0x00,0x00,0xC0,0x30,0x0C,0x02,0x0C,0x30,0xC0,0x00,0x00,0x00,0x00,0x00}, //'>'
		{0x00,0x38,0x44,0x82,0x82,0x02,0x04,0x08,0x10,0x10,0x10,0x00,0x10,0x10,0x00,0x00}, //'?'
		{0x00,0x00,0x38,0x44,0x82,0x9A,0xAA,0xAA,0xAA,0xAA,0xAA,0x96,0x80,0x42,0x3C,0x00}, //'@'
		{0x00,0x00,0x10,0x10,0x10,0x28,0x28,0x28,0x44,0x44,0x7C,0x44,0x44,0xEE,0x00,0x00}, //'A'
		{0x00,0x00,0xFC,0x42,0x42,0x42,0x42,0x7C,0x42,0x42,0x42,0x42,0x42,0xFC,0x00,0x00}, //'B'
		{0x00,0x00,0x3C,0x44,0x82,0x80,0x80,0x80,0x80,0x80,0x82,0x82,0x44,0x38,0x00,0x00}, //'C'
		{0x00,0x00,0xF8,0x44,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x44,0xF8,0x00,0x00}, //'D'
		{0x00,0x00,0xFC,0x44,0x42,0x40,0x44,0x7C,0x44,0x40,0x40,0x42,0x44,0xFC,0x00,0x00}, //'E'
		{0x00,0x00,0xFC,0x44,0x42,0x40,0x44,0x7C,0x44,0x40,0x40,0x40,0x40,0xF0,0x00,0x00}, //'F'
		{0x00,0x00,0x34,0x4C,0x82,0x80,0x80,0x80,0x8E,0x84,0x84,0x84,0x4C,0x34,0x00,0x00}, //'G'
		{0x00,0x00,0xEE,0x44,0x44,0x44,0x44,0x7C,0x44,0x44,0x44,0x44,0x44,0xEE,0x00,0x00}, //'H'
		{0x00,0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x7C,0x00,0x00}, //'I'
		{0x00,0x00,0x3E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x88,0x88,0x70,0x00,0x00}, //'J'
		{0x00,0x00,0xEE,0x44,0x48,0x48,0x50,0x60,0x50,0x48,0x48,0x44,0x44,0xEE,0x00,0x00}, //'K'
		{0x00,0x00,0xE0,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x42,0x44,0xFC,0x00,0x00}, //'L'
		{0x00,0x00,0xC6,0x44,0x6C,0x6C,0x6C,0x54,0x54,0x54,0x44,0x44,0x44,0xEE,0x00,0x00}, //'M'
		{0x00,0x00,0xCE,0x44,0x64,0x64,0x64,0x54,0x54,0x4C,0x4C,0x4C,0x44,0xE4,0x00,0x00}, //'N'
		{0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x44,0x38,0x00,0x00}, //'O'
		{0x00,0x00,0xF8,0x44,0x42,0x42,0x42,0x44,0x78,0x40,0x40,0x40,0x40,0xE0,0x00,0x00}, //'P'
		{0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0xBA,0x44,0x3C,0x02,0x00}, //'Q'
		{0x00,0x00,0xF0,0x48,0x44,0x44,0x44,0x48,0x70,0x48,0x44,0x44,0x44,0xE6,0x00,0x00}, //'R'
		{0x00,0x00,0x3C,0x44,0x82,0x80,0x40,0x30,0x0C,0x02,0x02,0x82,0x44,0x78,0x00,0x00}, //'S'
		{0x00,0x00,0x7C,0x54,0x92,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x38,0x00,0x00}, //'T'
		{0x00,0x00,0xEE,0x44,0x44,0x44,0x44,0x44,0x44,0x44,0x44,0x44,0x44,0x38,0x00,0x00}, //'U'
		{0x00,0x00,0xEE,0x44,0x44,0x44,0x44,0x28,0x28,0x28,0x28,0x10,0x10,0x10,0x00,0x00}, //'V'
		{0x00,0x00,0xEE,0x44,0x54,0x54,0x54,0x54,0x54,0x54,0x28,0x28,0x28,0x28,0x00,0x00}, //'W'
		{0x00,0x00,0xEE,0x44,0x44,0x28,0x28,0x10,0x10,0x28,0x28,0x44,0x44,0xEE,0x00,0x00}, //'X'
		{0x00,0x00,0xEE,0x44,0x44,0x28,0x28,0x28,0x10,0x10,0x10,0x10,0x10,0x38,0x00,0x00}, //'Y'
		{0x00,0x00,0x7E,0x44,0x84,0x08,0x08,0x10,0x20,0x20,0x40,0x82,0x84,0xFC,0x00,0x00}, //'Z'
		{0x00,0x1C,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1C,0x00}, //'['
		{0x00,0x00,0x20,0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x02,0x02,0x01,0x01,0x00,0x00}, //'\\'
		{0x00,0x70,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x70,0x00}, //']'
		{0x00,0x30,0x48,0x84,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'^'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00}, //'_'
		{0x00,0x40,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'`'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x84,0x04,0x7C,0x84,0x84,0x8C,0x76,0x00,0x00}, //'a'
		{0x00,0x00,0xC0,0x40,0x40,0x40,0x58,0x64,0x42,0x42,0x42,0x42,0x64,0x58,0x00,0x00}, //'b'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x44,0x80,0x80,0x80,0x80,0x44,0x38,0x00,0x00}, //'c'
		{0x00,0x00,0x0C,0x04,0x04,0x04,0x34,0x4C,0x84,0x84,0x84,0x84,0x4C,0x36,0x00,0x00}, //'d'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x84,0x84,0xFC,0x80,0x80,0x84,0x78,0x00,0x00}, //'e'
		{0x00,0x00,0x18,0x24,0x20,0x20,0xF8,0x20,0x20,0x20,0x20,0x20,0x20,0x70,0x00,0x00}, //'f'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x3A,0x44,0x44,0x78,0x80,0x7C,0x82,0x82,0x7C,0x00}, //'g'
		{0x00,0x00,0xC0,0x40,0x40,0x40,0x58,0x64,0x44,0x44,0x44,0x44,0x44,0xEE,0x00,0x00}, //'h'
		{0x00,0x00,0x10,0x10,0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0x10,0x38,0x00,0x00}, //'i'
		{0x00,0x00,0x10,0x10,0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0x10,0x90,0x60,0x00}, //'j'
		{0x00,0x00,0xC0,0x40,0x40,0x40,0x5C,0x48,0x50,0x60,0x50,0x48,0x44,0xEE,0x00,0x00}, //'k'
		{0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x38,0x00,0x00}, //'l'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xAC,0xD2,0x92,0x92,0x92,0x92,0x92,0xD6,0x00,0x00}, //'m'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x58,0xE4,0x44,0x44,0x44,0x44,0x44,0xEE,0x00,0x00}, //'n'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x44,0x38,0x00,0x00}, //'o'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xD8,0x64,0x42,0x42,0x42,0x64,0x58,0x40,0xE0,0x00}, //'p'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x36,0x4C,0x84,0x84,0x84,0x4C,0x34,0x04,0x0E,0x00}, //'q'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x6C,0x30,0x20,0x20,0x20,0x20,0x20,0x70,0x00,0x00}, //'r'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x88,0x84,0x60,0x18,0x84,0x44,0x78,0x00,0x00}, //'s'
		{0x00,0x00,0x00,0x20,0x20,0x20,0xF8,0x20,0x20,0x20,0x20,0x20,0x24,0x18,0x00,0x00}, //'t'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xC6,0x42,0x42,0x42,0x42,0x42,0x46,0x3A,0x00,0x00}, //'u'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xEE,0x44,0x44,0x28,0x28,0x28,0x10,0x10,0x00,0x00}, //'v'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xEE,0x44,0x44,0x54,0x54,0x28,0x28,0x28,0x00,0x00}, //'w'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xEE,0x44,0x28,0x10,0x10,0x28,0x44,0xEE,0x00,0x00}, //'x'
		{0x00,0x00,0x00,0x00,0x00,0x00,0xEE,0x44,0x44,0x28,0x28,0x10,0x10,0xA0,0xC0,0x00}, //'y'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x44,0x88,0x10,0x20,0x42,0x84,0xFC,0x00,0x00}, //'z'
		{0x00,0x0C,0x10,0x10,0x10,0x10,0x10,0x60,0x10,0x10,0x10,0x10,0x10,0x10,0x0C,0x00}, //'{'
		{0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00}, //'|'
		{0x00,0xC0,0x20,0x20,0x20,0x20,0x20,0x18,0x20,0x20,0x20,0x20,0x20,0x20,0xC0,0x00}, //'}'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x72,0x8C,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'~'
	};
};

class FontBuiltInEqualWidth : public Font
{
public:
	constexpr FontBuiltInEqualWidth() : Font({ 16,16 }) {}
	virtual const unsigned char* get(Unicode text) const override
	{
		if (text < 0x20) return error;

		text -= 0x20;
		if (text >= (sizeof(table) / sizeof(table[0]))) return error;

		return table[text];
	}

private:
	constexpr static unsigned char table[95][32] = {
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //' '
		{0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'!'
		{0x00,0x00,0x00,0x00,0x06,0xC0,0x06,0xC0,0x02,0x40,0x02,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'"'
		{0x00,0x00,0x02,0x40,0x02,0x40,0x02,0x40,0x02,0x40,0x0F,0xE0,0x04,0x80,0x04,0x80,0x04,0x80,0x04,0x80,0x0F,0xC0,0x09,0x00,0x09,0x00,0x09,0x00,0x09,0x00,0x00,0x00}, //'#'
		{0x00,0x00,0x01,0x00,0x03,0xC0,0x05,0x40,0x09,0x20,0x09,0x00,0x05,0x00,0x03,0x80,0x01,0x40,0x01,0x20,0x01,0x20,0x09,0x20,0x05,0x40,0x07,0x80,0x01,0x00,0x00,0x00}, //'$'
		{0x00,0x00,0x00,0x00,0x02,0x20,0x05,0xC0,0x09,0x40,0x0A,0x80,0x04,0x80,0x01,0x00,0x01,0x00,0x02,0x40,0x02,0xA0,0x05,0x20,0x05,0x40,0x08,0x80,0x00,0x00,0x00,0x00}, //'%'
		{0x00,0x00,0x00,0x00,0x03,0x00,0x04,0x80,0x04,0x80,0x05,0x00,0x02,0x00,0x06,0xE0,0x05,0x40,0x09,0x40,0x08,0xC0,0x08,0x80,0x08,0xA0,0x07,0x40,0x00,0x00,0x00,0x00}, //'&'
		{0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'\''
		{0x00,0x00,0x00,0x40,0x00,0x80,0x01,0x00,0x01,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x00,0x80,0x00,0x40,0x00,0x00}, //'('
		{0x00,0x00,0x08,0x00,0x04,0x00,0x02,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x02,0x00,0x02,0x00,0x04,0x00,0x08,0x00,0x00,0x00}, //')'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x05,0x40,0x03,0x80,0x01,0x00,0x03,0x80,0x05,0x40,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'*'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x0F,0xE0,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'+'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x02,0x00,0x00,0x00}, //','
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'-'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'.'
		{0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x40,0x00,0x80,0x00,0x80,0x01,0x00,0x01,0x00,0x02,0x00,0x02,0x00,0x04,0x00,0x04,0x00,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00}, //'/'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x09,0x20,0x09,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'0'
		{0x00,0x00,0x00,0x00,0x01,0x00,0x07,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x07,0xC0,0x00,0x00,0x00,0x00}, //'1'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x00,0x40,0x00,0x80,0x01,0x00,0x02,0x00,0x04,0x00,0x08,0x20,0x08,0x40,0x0F,0xC0,0x00,0x00,0x00,0x00}, //'2'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x00,0x20,0x00,0x40,0x03,0x80,0x00,0x40,0x00,0x20,0x00,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'3'
		{0x00,0x00,0x00,0x00,0x00,0x40,0x00,0xC0,0x01,0x40,0x01,0x40,0x02,0x40,0x02,0x40,0x04,0x40,0x04,0x40,0x0F,0xE0,0x00,0x40,0x00,0x40,0x00,0xE0,0x00,0x00,0x00,0x00}, //'4'
		{0x00,0x00,0x00,0x00,0x0F,0xC0,0x08,0x00,0x08,0x00,0x08,0x00,0x0B,0x80,0x0C,0x40,0x08,0x20,0x00,0x20,0x00,0x20,0x08,0x20,0x08,0x40,0x07,0x80,0x00,0x00,0x00,0x00}, //'5'
		{0x00,0x00,0x00,0x00,0x03,0xC0,0x04,0x20,0x08,0x20,0x08,0x00,0x0B,0x80,0x0C,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'6'
		{0x00,0x00,0x00,0x00,0x07,0xE0,0x04,0x20,0x08,0x20,0x00,0x40,0x00,0x40,0x00,0x80,0x00,0x80,0x00,0x80,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'7'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'8'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x04,0x60,0x03,0xA0,0x00,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'9'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //':'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x02,0x00,0x00,0x00,0x00,0x00}, //';'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x01,0x80,0x06,0x00,0x08,0x00,0x06,0x00,0x01,0x80,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'<'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'='
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x03,0x00,0x00,0xC0,0x00,0x20,0x00,0xC0,0x03,0x00,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'>'
		{0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x00,0x20,0x00,0x40,0x00,0x80,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'?'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x09,0xA0,0x0A,0xA0,0x0A,0xA0,0x0A,0xA0,0x0A,0xA0,0x0A,0xA0,0x09,0x60,0x08,0x00,0x04,0x20,0x03,0xC0,0x00,0x00}, //'@'
		{0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x02,0x80,0x02,0x80,0x02,0x80,0x04,0x40,0x04,0x40,0x07,0xC0,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'A'
		{0x00,0x00,0x00,0x00,0x0F,0xC0,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x07,0xC0,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x0F,0xC0,0x00,0x00,0x00,0x00}, //'B'
		{0x00,0x00,0x00,0x00,0x03,0xC0,0x04,0x40,0x08,0x20,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'C'
		{0x00,0x00,0x00,0x00,0x0F,0x80,0x04,0x40,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x40,0x0F,0x80,0x00,0x00,0x00,0x00}, //'D'
		{0x00,0x00,0x00,0x00,0x0F,0xC0,0x04,0x40,0x04,0x20,0x04,0x00,0x04,0x40,0x07,0xC0,0x04,0x40,0x04,0x00,0x04,0x00,0x04,0x20,0x04,0x40,0x0F,0xC0,0x00,0x00,0x00,0x00}, //'E'
		{0x00,0x00,0x00,0x00,0x0F,0xC0,0x04,0x40,0x04,0x20,0x04,0x00,0x04,0x40,0x07,0xC0,0x04,0x40,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x0F,0x00,0x00,0x00,0x00,0x00}, //'F'
		{0x00,0x00,0x00,0x00,0x03,0x40,0x04,0xC0,0x08,0x20,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0xE0,0x08,0x40,0x08,0x40,0x08,0x40,0x04,0xC0,0x03,0x40,0x00,0x00,0x00,0x00}, //'G'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x07,0xC0,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'H'
		{0x00,0x00,0x00,0x00,0x07,0xC0,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x07,0xC0,0x00,0x00,0x00,0x00}, //'I'
		{0x00,0x00,0x00,0x00,0x03,0xE0,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x08,0x80,0x08,0x80,0x07,0x00,0x00,0x00,0x00,0x00}, //'J'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x80,0x04,0x80,0x05,0x00,0x06,0x00,0x05,0x00,0x04,0x80,0x04,0x80,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'K'
		{0x00,0x00,0x00,0x00,0x0E,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x20,0x04,0x40,0x0F,0xC0,0x00,0x00,0x00,0x00}, //'L'
		{0x00,0x00,0x00,0x00,0x0C,0x60,0x04,0x40,0x06,0xC0,0x06,0xC0,0x06,0xC0,0x05,0x40,0x05,0x40,0x05,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'M'
		{0x00,0x00,0x00,0x00,0x0C,0xE0,0x04,0x40,0x06,0x40,0x06,0x40,0x06,0x40,0x05,0x40,0x05,0x40,0x04,0xC0,0x04,0xC0,0x04,0xC0,0x04,0x40,0x0E,0x40,0x00,0x00,0x00,0x00}, //'N'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'O'
		{0x00,0x00,0x00,0x00,0x0F,0x80,0x04,0x40,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x40,0x07,0x80,0x04,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x0E,0x00,0x00,0x00,0x00,0x00}, //'P'
		{0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x0B,0xA0,0x04,0x40,0x03,0xC0,0x00,0x20,0x00,0x00}, //'Q'
		{0x00,0x00,0x00,0x00,0x0F,0x00,0x04,0x80,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x80,0x07,0x00,0x04,0x80,0x04,0x40,0x04,0x40,0x04,0x40,0x0E,0x60,0x00,0x00,0x00,0x00}, //'R'
		{0x00,0x00,0x00,0x00,0x03,0xC0,0x04,0x40,0x08,0x20,0x08,0x00,0x04,0x00,0x03,0x00,0x00,0xC0,0x00,0x20,0x00,0x20,0x08,0x20,0x04,0x40,0x07,0x80,0x00,0x00,0x00,0x00}, //'S'
		{0x00,0x00,0x00,0x00,0x07,0xC0,0x05,0x40,0x09,0x20,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x03,0x80,0x00,0x00,0x00,0x00}, //'T'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'U'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x02,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'V'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x05,0x40,0x05,0x40,0x05,0x40,0x05,0x40,0x05,0x40,0x05,0x40,0x02,0x80,0x02,0x80,0x02,0x80,0x02,0x80,0x00,0x00,0x00,0x00}, //'W'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x02,0x80,0x02,0x80,0x01,0x00,0x01,0x00,0x02,0x80,0x02,0x80,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'X'
		{0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x02,0x80,0x02,0x80,0x02,0x80,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x03,0x80,0x00,0x00,0x00,0x00}, //'Y'
		{0x00,0x00,0x00,0x00,0x07,0xE0,0x04,0x40,0x08,0x40,0x00,0x80,0x00,0x80,0x01,0x00,0x02,0x00,0x02,0x00,0x04,0x00,0x08,0x20,0x08,0x40,0x0F,0xC0,0x00,0x00,0x00,0x00}, //'Z'
		{0x00,0x00,0x01,0xC0,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0xC0,0x00,0x00}, //'['
		{0x00,0x00,0x00,0x00,0x02,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x00,0x80,0x00,0x80,0x00,0x40,0x00,0x40,0x00,0x20,0x00,0x20,0x00,0x10,0x00,0x10,0x00,0x00,0x00,0x00}, //'\\'
		{0x00,0x00,0x07,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x07,0x00,0x00,0x00}, //']'
		{0x00,0x00,0x03,0x00,0x04,0x80,0x08,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'^'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xE0,0x00,0x00}, //'_'
		{0x00,0x00,0x04,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'`'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x08,0x40,0x00,0x40,0x07,0xC0,0x08,0x40,0x08,0x40,0x08,0xC0,0x07,0x60,0x00,0x00,0x00,0x00}, //'a'
		{0x00,0x00,0x00,0x00,0x0C,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x05,0x80,0x06,0x40,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x06,0x40,0x05,0x80,0x00,0x00,0x00,0x00}, //'b'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'c'
		{0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x40,0x00,0x40,0x00,0x40,0x03,0x40,0x04,0xC0,0x08,0x40,0x08,0x40,0x08,0x40,0x08,0x40,0x04,0xC0,0x03,0x60,0x00,0x00,0x00,0x00}, //'d'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x08,0x40,0x08,0x40,0x0F,0xC0,0x08,0x00,0x08,0x00,0x08,0x40,0x07,0x80,0x00,0x00,0x00,0x00}, //'e'
		{0x00,0x00,0x00,0x00,0x01,0x80,0x02,0x40,0x02,0x00,0x02,0x00,0x0F,0x80,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x07,0x00,0x00,0x00,0x00,0x00}, //'f'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xA0,0x04,0x40,0x04,0x40,0x07,0x80,0x08,0x00,0x07,0xC0,0x08,0x20,0x08,0x20,0x07,0xC0,0x00,0x00}, //'g'
		{0x00,0x00,0x00,0x00,0x0C,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x05,0x80,0x06,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'h'
		{0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x03,0x80,0x00,0x00,0x00,0x00}, //'i'
		{0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x09,0x00,0x06,0x00,0x00,0x00}, //'j'
		{0x00,0x00,0x00,0x00,0x0C,0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x05,0xC0,0x04,0x80,0x05,0x00,0x06,0x00,0x05,0x00,0x04,0x80,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'k'
		{0x00,0x00,0x00,0x00,0x03,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x03,0x80,0x00,0x00,0x00,0x00}, //'l'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0xC0,0x0D,0x20,0x09,0x20,0x09,0x20,0x09,0x20,0x09,0x20,0x09,0x20,0x0D,0x60,0x00,0x00,0x00,0x00}, //'m'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x80,0x0E,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'n'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x04,0x40,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x04,0x40,0x03,0x80,0x00,0x00,0x00,0x00}, //'o'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0D,0x80,0x06,0x40,0x04,0x20,0x04,0x20,0x04,0x20,0x06,0x40,0x05,0x80,0x04,0x00,0x0E,0x00,0x00,0x00}, //'p'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x60,0x04,0xC0,0x08,0x40,0x08,0x40,0x08,0x40,0x04,0xC0,0x03,0x40,0x00,0x40,0x00,0xE0,0x00,0x00}, //'q'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0xC0,0x03,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x07,0x00,0x00,0x00,0x00,0x00}, //'r'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x08,0x80,0x08,0x40,0x06,0x00,0x01,0x80,0x08,0x40,0x04,0x40,0x07,0x80,0x00,0x00,0x00,0x00}, //'s'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x0F,0x80,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x40,0x01,0x80,0x00,0x00,0x00,0x00}, //'t'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x60,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x60,0x03,0xA0,0x00,0x00,0x00,0x00}, //'u'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x02,0x80,0x02,0x80,0x02,0x80,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00}, //'v'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x05,0x40,0x05,0x40,0x02,0x80,0x02,0x80,0x02,0x80,0x00,0x00,0x00,0x00}, //'w'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x02,0x80,0x01,0x00,0x01,0x00,0x02,0x80,0x04,0x40,0x0E,0xE0,0x00,0x00,0x00,0x00}, //'x'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0xE0,0x04,0x40,0x04,0x40,0x02,0x80,0x02,0x80,0x01,0x00,0x01,0x00,0x0A,0x00,0x0C,0x00,0x00,0x00}, //'y'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x04,0x40,0x08,0x80,0x01,0x00,0x02,0x00,0x04,0x20,0x08,0x40,0x0F,0xC0,0x00,0x00,0x00,0x00}, //'z'
		{0x00,0x00,0x00,0xC0,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x06,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0xC0,0x00,0x00}, //'{'
		{0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00}, //'|'
		{0x00,0x00,0x0C,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x01,0x80,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x0C,0x00,0x00,0x00}, //'}'
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x20,0x08,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, //'~'
	};
};

class FontNone : public Font
{
public:
	FontNone() : Font({ 8,16 }) {}
};

class FontUnicode : public Font
{
public:
	FontUnicode() : Font({ 16,16 })
	{
		cacheIndex = new CharacterIndex[cacheSize];
		cache = new Character[cacheSize];
	}

	virtual const unsigned char* get(Unicode text) const override
	{
		auto ret = getFromCache(text);
		if (ret != error) [[likely]] return ret;
		return getFromAlgorithm(text);
	};

private:
	using Character = unsigned char[32];
	class CharacterIndex
	{
	public:
		Unicode unicode = 0;
		unsigned char access = 0; // 二次机会

		constexpr static unsigned char DefaultAccess = 1;
	};

	constexpr static char numberTable[16][8] = {
		{0x00,0x3C,0x24,0x24,0x24,0x24,0x24,0x3C}, // 0
		{0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x04}, // 1
		{0x00,0x3C,0x04,0x04,0x3C,0x20,0x20,0x3C}, // 2
		{0x00,0x3C,0x04,0x04,0x3C,0x04,0x04,0x3C}, // 3
		{0x00,0x24,0x24,0x24,0x3C,0x04,0x04,0x04}, // 4
		{0x00,0x3C,0x20,0x20,0x3C,0x04,0x04,0x3C}, // 5
		{0x00,0x3C,0x20,0x20,0x3C,0x24,0x24,0x3C}, // 6
		{0x00,0x3C,0x04,0x04,0x04,0x04,0x04,0x04}, // 7
		{0x00,0x3C,0x24,0x24,0x3C,0x24,0x24,0x3C}, // 8
		{0x00,0x3C,0x24,0x24,0x3C,0x04,0x04,0x3C}, // 9
		{0x00,0x3C,0x24,0x24,0x3C,0x24,0x24,0x24}, // A
		{0x00,0x38,0x24,0x24,0x38,0x24,0x24,0x38}, // B
		{0x00,0x1C,0x20,0x20,0x20,0x20,0x20,0x1C}, // C
		{0x00,0x38,0x24,0x24,0x24,0x24,0x24,0x38}, // D
		{0x00,0x3C,0x20,0x20,0x3C,0x20,0x20,0x3C}, // E
		{0x00,0x3C,0x20,0x20,0x3C,0x20,0x20,0x20}, // F
	};

	unsigned short cacheSize = 32;

	mutable Mutex cacheMutex{};
	mutable unsigned short cacheReplaceSearchIndex = 0;
	mutable CharacterIndex* cacheIndex = nullptr;
	mutable Character* cache = nullptr;

	const unsigned char* getFromCache(Unicode unicode) const
	{
		for (unsigned short i = 0; i < cacheSize; i++)
		{
			if (cacheIndex[i].unicode == unicode) [[unlikely]]
			{
				cacheIndex[i].access = CharacterIndex::DefaultAccess;
				return cache[i];
			}
		}
		return error;
	}
	const unsigned char* getFromAlgorithm(Unicode unicode) const
	{
		// 假定cache中没有（有的话也只是浪费空间而已）
		Lock lock{ cacheMutex };

		// 寻找空闲
		unsigned short i = searchReplaceIndex();

		//生成字符
		auto& font = cache[i];
		unsigned char nums[4]{
			(unsigned char)((unicode >> 12) & 0x0F),
			(unsigned char)((unicode >> 8) & 0x0F),
			(unsigned char)((unicode >> 4) & 0x0F),
			(unsigned char)((unicode >> 0) & 0x0F) };

		for (int j = 0; j < 8; j++)
			font[j * 2] = numberTable[nums[0]][j];
		for (int j = 0; j < 8; j++)
			font[j * 2 + 1] = numberTable[nums[1]][j];
		for (int j = 0; j < 8; j++)
			font[j * 2 + 16] = numberTable[nums[2]][j];
		for (int j = 0; j < 8; j++)
			font[j * 2 + 17] = numberTable[nums[3]][j];

		cacheIndex[i].unicode = unicode;
		cacheIndex[i].access = CharacterIndex::DefaultAccess;

		return font;
	}

	unsigned short searchReplaceIndex() const
	{
		unsigned short i = cacheReplaceSearchIndex;

		while (true)
		{
			if (cacheIndex[i].access == 0) [[unlikely]] break;

			cacheIndex[i].access--;
			i = (i + 1) % cacheSize;
		}

		cacheReplaceSearchIndex = (i + 1) % cacheSize;
		return i;
	}
};

class FontInFile : public Font
{
public:
	FontInFile(unsigned short cacheSize = 512) : Font({ 16, 16 }), cacheSize{ cacheSize }
	{
		cacheIndex = new CharacterIndex[cacheSize];
		cache = new Character[cacheSize];
	}

	virtual ~FontInFile()
	{
		file.close();
		delete[] cacheIndex;
		cacheIndex = nullptr;
		delete[] cache;
		cache = nullptr;
	}

	bool loadFromPath(const char* path)
	{
		Floor root;
		root.open(PerfixRoot);
		if (!root.openFile(path, strlen(path), file))
			return false;

		file.reGetSize();
		fontSize = file.getSize() / (sizeof(Unicode) + sizeof(Character));
		fontSectionOffset = sizeof(Unicode) * fontSize;

		for (unsigned short i = 0; i < cacheSize; i++)
			cacheIndex[i].unicode = 0x00;

		return true;
	}

	virtual const unsigned char* get(Unicode text) const override
	{
		auto index = getFromCache(text);
		if (index == NotFound) [[unlikely]]
			index = getFromFile(text);

		if (cacheIndex[index].aviliable) [[likely]]
			return cache[index];
		else return error;
	};

private:
	using Character = unsigned char[32];
	class CharacterIndex
	{
	public:
		Unicode unicode = 0;
		bool aviliable = false; // 是否存在该字
		unsigned char access = 0; // 二次机会

		constexpr static unsigned char DefaultAccess = 1;
	};

	mutable IFile file{};
	unsigned short fontSize = 0;
	IFile::OffsetType fontSectionOffset = 0;

	unsigned short cacheSize = 512;
	constexpr static unsigned short NotFound = -1;

	mutable Mutex cacheMutex{};
	mutable unsigned short cacheReplaceSearchIndex = 0;
	mutable CharacterIndex* cacheIndex = nullptr;
	mutable Character* cache = nullptr;

	unsigned short getFromCache(Unicode unicode) const
	{
		for (unsigned short i = 0; i < cacheSize; i++)
		{
			if (cacheIndex[i].unicode == unicode) [[unlikely]]
			{
				cacheIndex[i].access = CharacterIndex::DefaultAccess;
				return i;
			}
		}
		return NotFound;
	}

	unsigned short getFromFile(Unicode unicode) const
	{
		// 假定cache中没有（有的话也只是浪费空间而已）
		Lock lock{ cacheMutex };

		// 搜索flash -> 二分
		unsigned short fontPosition = NotFound;
		{
			int left = -1;
			int right = fontSize;
			Unicode leftUnicode = 0;
			Unicode midUnicode = 0;

			while (left + 1 != right)
			{
				int mid = (left + right) / 2;

				file.setOffset(mid * sizeof(Unicode));
				file.read(&midUnicode, sizeof(Unicode));
				if (midUnicode <= unicode)
				{
					leftUnicode = midUnicode;
					left = mid;
				}
				else right = mid;
			}
			if (leftUnicode == unicode) fontPosition = left;
		}

		// 寻找空闲
		unsigned short i = searchReplaceIndex();

		if (fontPosition != NotFound) [[likely]]
		{
			cacheIndex[i].aviliable = true;
			file.setOffset(fontSectionOffset + fontPosition * sizeof(Character));
			file.read(cache[i], sizeof(Character));
		}
		else cacheIndex[i].aviliable = false;
		cacheIndex[i].unicode = unicode;
		cacheIndex[i].access = CharacterIndex::DefaultAccess;

		return i;
	}

	unsigned short searchReplaceIndex() const
	{
		unsigned short i = cacheReplaceSearchIndex;

		while (true)
		{
			if (cacheIndex[i].access == 0) [[unlikely]] break;

			cacheIndex[i].access--;
			i = (i + 1) % cacheSize;
		}

		cacheReplaceSearchIndex = (i + 1) % cacheSize;
		return i;
	}
};

Font* Font::load(const char* path)
{
	auto font = new FontInFile;
	if (!font->loadFromPath(path))
	{
		delete font;
		font = nullptr;
	}

	return font;
}

static const FontBuiltIn fontBuiltInHalfWidthReal{};
static const FontBuiltInEqualWidth fontBuiltInFullWidthReal{};
static const FontNone fontNoneReal{};
static const FontUnicode fontUnicodeReal{};

const Font* const fontBuiltInHalfWidth = &fontBuiltInHalfWidthReal;
const Font* const fontBuiltInFullWidth = &fontBuiltInFullWidthReal;
const Font* const fontNone = &fontNoneReal;
const Font* const fontUnicode = &fontUnicodeReal;
const Font* fontChinese = fontNone;

Fonts fontsDefault{ {fontBuiltInHalfWidth, fontChinese, fontUnicode} };
Fonts fontsFullWidth{ {fontBuiltInFullWidth,fontChinese, fontUnicode} };
